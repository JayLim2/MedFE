<div class="page">
  <div class="page__title">
    Личный кабинет
  </div>
  <div class="page__content">
    <!--    <ng-container *ngIf="!authenticationService.isAuthenticated(); else lk">-->
    <ng-container *ngIf="false; else lk">
      <div class="message error">
        Извините, но пока что Вам сюда нельзя. <a routerLink="login">Войдите</a> в систему.
      </div>
    </ng-container>
    <ng-template #lk>
      <div class="tabs">
        <div class="tab"
             [ngClass]="selectedTab === 'main' ? 'selected' : ''"
             (click)="onTabClick('main')"
        >
          Основные данные
        </div>
        <div class="tab"
             [ngClass]="selectedTab === 'tickets' ? 'selected' : ''"
             (click)="onTabClick('tickets')"
        >
          Талоны
        </div>
        <div class="tab"
             [ngClass]="selectedTab === 'prescriptions' ? 'selected' : ''"
             (click)="onTabClick('prescriptions')"
        >
          Назначения
        </div>
        <div class="tab"
             [ngClass]="selectedTab === 'support' ? 'selected' : ''"
             (click)="onTabClick('support')"
        >
          Служба поддержки
        </div>
      </div>
    </ng-template>

    <ng-container [ngSwitch]="selectedTab">
      <ng-container *ngSwitchCase="'main'">
        <ng-content *ngTemplateOutlet="main"></ng-content>
      </ng-container>
      <ng-container *ngSwitchCase="'tickets'">
        <ng-content *ngTemplateOutlet="tickets"></ng-content>
      </ng-container>
      <ng-container *ngSwitchCase="'prescriptions'">
        <ng-content *ngTemplateOutlet="prescriptions"></ng-content>
      </ng-container>
      <ng-container *ngSwitchCase="'support'">
        <ng-content *ngTemplateOutlet="support"></ng-content>
      </ng-container>
    </ng-container>
  </div>
</div>

<ng-template #main>
  <ng-container [ngSwitch]="currentUser.role">
    Вы вошли как
    <ng-container *ngSwitchCase="'PATIENT'">
      <b>пациент</b>
    </ng-container>
    <ng-container *ngSwitchCase="'DOCTOR'">
      <b>врач</b>
    </ng-container>
    <ng-container *ngSwitchCase="'ADMIN'">
      <b>администратор</b>
    </ng-container>
  </ng-container>

  <div style="display: flex; margin:25px 0;">
    <!-- avatar -->
    <div style="display: flex; flex-direction: column;text-align: center">
      <img src="https://sun9-21.userapi.com/c849028/v849028742/163975/Xx9_qlxiDng.jpg"
           style="width: 140px; border-radius: 10px"
           alt="Фото профиля"
      />
      <!--<a routerLink="profile/editAvatar">
        <span style="font-size: 11pt">
          Изменить фото
        </span>
      </a>-->
    </div>
    <!-- main data -->
    <div style="display: flex; flex-direction: column; margin-left: 25px;">
      <data-field [name]="'Фамилия, имя, отчество'"
                  [value]="currentUser.name()"
      ></data-field>
      <!-- for doctor -->
      <ng-container *ngIf="currentDoctor">
        <data-field [name]="'Специализация'"
                    [value]="currentDoctor.specialization.name"
        ></data-field>
        <data-field [name]="'Кабинет'"
                    [value]="currentDoctor.cabinet.name"
        ></data-field>
      </ng-container>
      <!-- for patient -->
      <ng-container *ngIf="currentPatient">
        <data-field [name]="'Дата рождения'"
                    [value]="currentPatient.birthday"
        ></data-field>
        <data-field [name]="'Полис ОМС'"
                    [value]="currentPatient.insurancePolicyNumber"
        ></data-field>
      </ng-container>
    </div>
  </div>
</ng-template>

<ng-template #tickets>
  <div>
    Талоны, который оформил пациент или получил врач.
    <button class="button medium"
            style="width: 250px; margin-left: 20px"
            routerLink="/tickets/create"
    >Записаться на прием
    </button>
  </div>

  <div class="tickets">
    <div *ngFor="let ticket of patientTicketsList"
         class="ticket"
    >
      <div class="ticket__header">
        Талон № {{ticket.id}}
      </div>
      <div class="ticket__content">
        <div class="data">
          <data-field [name]="'Пациент'"
                      [value]="ticket.patient.user.name()"
          ></data-field>
          <data-field [name]="'Время приема'"
                      [value]="ticket.datetime"
          ></data-field>
          <data-field [name]="'Врач'"
                      [value]="ticket.doctor.user.name()"
          ></data-field>
          <data-field [name]="'Кабинет'"
                      [value]="ticket.doctor.cabinet.name"
          ></data-field>
          <data-field [name]="'Специализация'"
                      [value]="ticket.doctor.specialization.name"
          ></data-field>
          <data-field [name]="'Полис ОМС пациента'"
                      [value]="ticket.patient.insurancePolicyNumber"
          ></data-field>
        </div>

        <div class="controls">
          <ng-container [ngSwitch]="currentUser.role">
            <ng-container *ngSwitchCase="'PATIENT'">
              <popup *ngIf="ticket.prescriptions"
                     [popupTitle]="'Мои назначения'"
                     [buttonTitle]="'Мои назначения'"
                     [styles]="'outline available-width'"
              >
                {{ticket.prescriptions}}
              </popup>
              <popup [popupTitle]="'Изменить время приема'"
                     [buttonTitle]="'Изменить время приема'"
                     [styles]="'available-width'"
              >
                <!-- time -->
                <div style="display: flex; flex-direction: column">
                  Введите другое время приема:
                  <input type="datetime-local"/>

                  <div style="color: gray;margin:10px 0;">
                    Если ячейка календаря выделена серым цветом, значит это выходной день,
                    талоны закончились или врач не принимиает в выбранное время.
                    <br/><br/>
                    <a routerLink="support">Напишите нам</a>, если считаете, что время недоступно по ошибке.
                  </div>
                </div>
                <!---------->
              </popup>
              <popup [popupTitle]="'Отменить талон?'"
                     [buttonTitle]="'Отменить талон'"
                     [styles]="'reject-button available-width'"
                     [type]="'confirm'"
              >
                Вы действительно хотите отменить талон?
              </popup>
            </ng-container>
            <ng-container *ngSwitchCase="'DOCTOR'">
              <popup [popupTitle]="'Добавить назначения для пациента'"
                     [buttonTitle]="ticket.prescriptions ? 'Назначения' : 'Добавить назначения'"
                     [styles]="'outline available-width'"
                     [customButtons]="ticket.prescriptions ? [] : [savePrescriptionButton]"
              >
                <ng-container
                  *ngIf="ticket.prescriptions; then readonlyPrescriptions else editablePrescriptiopns"></ng-container>
                <ng-template #readonlyPrescriptions>
                  {{ticket.prescriptions}}
                </ng-template>
                <ng-template #editablePrescriptiopns>
                  <label style="width: 100%;">
                    Введите назначения:
                    <textarea class="input-control"
                              style="width: 100%; height: 200px;"
                              placeholder="Например, не употреблять в пищу жирное и жареное 3 месяца."
                    ></textarea>
                  </label>
                </ng-template>

                <div style="color: red; margin: 10px 0;">
                  Внимание! Назначения невозможно отредактировать после сохранения.
                </div>
              </popup>
              <popup [popupTitle]="'Изменить время приема'"
                     [buttonTitle]="'Изменить время приема'"
                     [styles]="'available-width'"
              >
                <!-- time -->
                <div style="display: flex; flex-direction: column">
                  Введите другое время приема:
                  <input type="datetime-local"/>

                  <div style="color: gray;margin:10px 0;">
                    Если ячейка календаря выделена серым цветом, значит это выходной день,
                    талоны закончились или врач не принимиает в выбранное время.
                    <br/><br/>
                    <a routerLink="support">Напишите нам</a>, если считаете, что время недоступно по ошибке.
                  </div>
                </div>
                <!---------->
              </popup>
              <popup [popupTitle]="'Отменить талон?'"
                     [buttonTitle]="'Отменить талон'"
                     [styles]="'reject-button available-width'"
                     [type]="'confirm'"
              >
                Вы действительно хотите отменить талон?
              </popup>
            </ng-container>
          </ng-container>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #prescriptions>
  Назначения, которые получил пациент или сформировал врач.

  <div class="tickets">
    <div class="ticket">
      <div class="ticket__header">
        Назначение врача по талону № 3
      </div>
      <div class="ticket__content">
        <div class="data">
          <data-field [name]="'Пациент'"
                      [value]="'Комаров Сергей Геннадьевич'"
          ></data-field>
          <data-field [name]="'Врач'"
                      [value]="'Лечилов Александр Георгиевич'"
          ></data-field>
          <data-field [name]="'Назначение'"
                      [value]="'Пиво, водка, кислота наши лучшие друзья'"
          ></data-field>
        </div>

        <div class="controls">
          <popup [popupTitle]="'Просмотр талона'"
                 [buttonTitle]="'Талон'"
                 [styles]="'outline available-width'"
          >
            <!-- ticket -->
            <div class="tickets">
              <div class="ticket in-popup">
                <div class="ticket__header">
                  Талон № 3
                </div>
                <div class="ticket__content">
                  <div class="data">
                    <data-field [name]="'Пациент'"
                                [value]="'Комаров Сергей Геннадьевич'"
                    ></data-field>
                    <data-field [name]="'Время приема'"
                                [value]="'21.11.2020 16:30'"
                    ></data-field>
                    <data-field [name]="'Врач'"
                                [value]="'Кромсалов Ганнибал Лекторович'"
                    ></data-field>
                    <data-field [name]="'Кабинет'"
                                [value]="'32'"
                    ></data-field>
                    <data-field [name]="'Специализация'"
                                [value]="'хирург'"
                    ></data-field>
                    <data-field [name]="'Полис ОМС пациента'"
                                [value]="'0000-0000 00 000'"
                    ></data-field>
                  </div>
                </div>
              </div>
            </div>
            <!-- / -->
          </popup>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #support>
  Служба поддержки работает 24/7, чтобы Вы могли получать качественные услуги.

  <div class="tickets">
    <div class="ticket">
      <div class="ticket__header">
        Обращение в поддержку №1
      </div>
      <div class="ticket__content">
        <div class="data">
          <div class="support-ticket-status opened"></div>

          <data-field [name]="'Логин пользователя'"
                      [value]="'+78005553535'"
          ></data-field>
          <data-field [name]="'С чем возникла проблема:'"
                      [value]="'Запись на прием'"
          ></data-field>
          <data-field [name]="'Описание проблемы'"
                      [value]="'Я куда-то нажал и оно всё сломалось. Почините.'"
          ></data-field>
        </div>

        <div class="controls">
          <popup [popupTitle]="'Служба поддержки'"
                 [buttonTitle]="'Открыть чат'"
                 [styles]="'available-width'"
                 [customButtons]="[supportChatButton]"
          >
            <!-- chat -->
            <chat></chat>
            <!-- / -->
          </popup>
          <popup [popupTitle]="'Закрыть обращение?'"
                 [buttonTitle]="'Закрыть обращение'"
                 [styles]="'reject-button available-width'"
                 [type]="'confirm'"
          >
            Вы точно хотите закрыть обращение?
          </popup>
        </div>
      </div>
    </div>
  </div>
</ng-template>
